# è£œå£“ä»£æ”¶è«‹æ¬¾æ—¥ - æŽ’é™¤é€€è²¨è¨‚å–®ç‰ˆ

## ðŸ“‹ èªªæ˜Ž

æ­¤ç‚ºä¿®æ­£ç‰ˆçš„è£œå£“ä»£æ”¶è«‹æ¬¾æ—¥ SQL,**å·²åŠ å…¥æŽ’é™¤é€€è²¨è¨‚å–®çš„é‚è¼¯**,é¿å…å†æ¬¡ç™¼ç”Ÿèª¤æ’¥ã€‚

**ä¿®æ­£é‡é»ž**:
- âœ… åªå£“ã€Œè²·å®¶å·²å–ä»¶ã€æˆ–ã€Œæ¶ˆè²»è€…æˆåŠŸå–ä»¶ã€çš„è¨‚å–®
- âœ… æŽ’é™¤æ‰€æœ‰é€€è²¨ã€å–æ¶ˆã€é€¾æœŸç­‰ç•°å¸¸ç‹€æ…‹çš„è¨‚å–®
- âœ… é©ç”¨æ–¼ C2Cã€å¤§å®—å¿«æ’¥ã€7-11å†·å‡C2C(21) æ‰€æœ‰æœå‹™

---

## æ­¥é©Ÿ 0:ç¸½è¦½æŸ¥è©¢ - ç¢ºèªéœ€è¦è£œå£“çš„è¨‚å–®(å·²æŽ’é™¤é€€è²¨)

### æŸ¥è©¢ä¸€èˆ¬ C2C + å¤§å®—å¿«æ’¥

```sql
-- ========================================
-- ç¸½è¦½ - æŸ¥è©¢æ‰€æœ‰éœ€è¦è£œå£“ä»£æ”¶è«‹æ¬¾æ—¥çš„è¨‚å–®(æŽ’é™¤é€€è²¨)
-- ========================================
SELECT
    CASE
        WHEN oa.CheckoutDate >= '2025-09-22' AND oa.CheckoutDate < '2025-09-29' THEN '2025-10-01'
        WHEN oa.CheckoutDate >= '2025-09-29' AND oa.CheckoutDate < '2025-10-06' THEN '2025-10-08'
        WHEN oa.CheckoutDate >= '2025-10-06' AND oa.CheckoutDate < '2025-10-13' THEN '2025-10-15'
        ELSE NULL
    END AS ShouldCheckoutDaisouDate,
    Logistic_service,
    CASE
        WHEN Logistic_service IN ('01','03','05','10','23') THEN 'C2Cäº¤è²¨ä¾¿'
        WHEN Logistic_service IN ('02','04','22','24') THEN 'å¤§å®—å¿«æ’¥'
        ELSE 'å…¶ä»–'
    END AS ServiceType,
    COUNT(*) as OrderCount,
    SUM(TotalAmount) as TotalAmount
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-09-22 00:00:00'
    AND oa.CheckoutDate < '2025-10-13 00:00:00'
    AND (
        -- C2C äº¤è²¨ä¾¿/åº—åˆ°åº—(æŽ’é™¤21)
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        -- å¤§å®—å¿«æ’¥
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… é‡é»ž:åªå£“æ­£å¸¸å–ä»¶çš„è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    )
GROUP BY
    CASE
        WHEN oa.CheckoutDate >= '2025-09-22' AND oa.CheckoutDate < '2025-09-29' THEN '2025-10-01'
        WHEN oa.CheckoutDate >= '2025-09-29' AND oa.CheckoutDate < '2025-10-06' THEN '2025-10-08'
        WHEN oa.CheckoutDate >= '2025-10-06' AND oa.CheckoutDate < '2025-10-13' THEN '2025-10-15'
        ELSE NULL
    END,
    Logistic_service
ORDER BY ShouldCheckoutDaisouDate, Logistic_service;
```

### æŸ¥è©¢ 21 (7-11å†·å‡C2C)

```sql
-- ========================================
-- ç¸½è¦½ - æŸ¥è©¢ 21 (7-11å†·å‡C2C) éœ€è¦è£œå£“çš„è¨‚å–®(æŽ’é™¤é€€è²¨)
-- ========================================
SELECT
    CASE
        WHEN lph.datadatetime >= '2025-09-22' AND lph.datadatetime < '2025-09-29' THEN '2025-10-01'
        WHEN lph.datadatetime >= '2025-09-29' AND lph.datadatetime < '2025-10-06' THEN '2025-10-08'
        WHEN lph.datadatetime >= '2025-10-06' AND lph.datadatetime < '2025-10-13' THEN '2025-10-15'
        ELSE NULL
    END AS ShouldCheckoutDaisouDate,
    COUNT(*) as OrderCount,
    SUM(oa.TotalAmount) as TotalAmount
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno,
        datadatetime
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-09-22 00:00:00'
        AND datadatetime < '2025-10-13 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… é‡é»ž:åªå£“æ­£å¸¸å–ä»¶çš„è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    )
GROUP BY
    CASE
        WHEN lph.datadatetime >= '2025-09-22' AND lph.datadatetime < '2025-09-29' THEN '2025-10-01'
        WHEN lph.datadatetime >= '2025-09-29' AND lph.datadatetime < '2025-10-06' THEN '2025-10-08'
        WHEN lph.datadatetime >= '2025-10-06' AND lph.datadatetime < '2025-10-13' THEN '2025-10-15'
        ELSE NULL
    END
ORDER BY ShouldCheckoutDaisouDate;
```

---

## æ­¥é©Ÿ 1:è£œå£“ 10/1 çš„ä»£æ”¶è«‹æ¬¾æ—¥(ä¸€èˆ¬ C2C + å¤§å®—å¿«æ’¥)

### 1-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 10/1 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(9/22-9/28) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows,
    Logistic_service,
    COUNT(*) as ServiceCount
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-09-22 00:00:00'
    AND oa.CheckoutDate < '2025-09-29 00:00:00'
    AND (
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    )
GROUP BY Logistic_service;
```

### 1-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 10/1 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(9/22-9/28) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-01'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-09-22 00:00:00'
    AND oa.CheckoutDate < '2025-09-29 00:00:00'
    AND (
        -- C2C äº¤è²¨ä¾¿/åº—åˆ°åº—
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        -- å¤§å®—å¿«æ’¥
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 2:è£œå£“ 10/8 çš„ä»£æ”¶è«‹æ¬¾æ—¥(ä¸€èˆ¬ C2C + å¤§å®—å¿«æ’¥)

### 2-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 10/8 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(9/29-10/5) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows,
    Logistic_service,
    COUNT(*) as ServiceCount
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-09-29 00:00:00'
    AND oa.CheckoutDate < '2025-10-06 00:00:00'
    AND (
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    )
GROUP BY Logistic_service;
```

### 2-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 10/8 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(9/29-10/5) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-08'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-09-29 00:00:00'
    AND oa.CheckoutDate < '2025-10-06 00:00:00'
    AND (
        -- C2C äº¤è²¨ä¾¿/åº—åˆ°åº—
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        -- å¤§å®—å¿«æ’¥
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 3:è£œå£“ 10/15 çš„ä»£æ”¶è«‹æ¬¾æ—¥(ä¸€èˆ¬ C2C + å¤§å®—å¿«æ’¥)

### 3-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 10/15 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(10/6-10/12) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows,
    Logistic_service,
    COUNT(*) as ServiceCount
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-10-06 00:00:00'
    AND oa.CheckoutDate < '2025-10-13 00:00:00'
    AND (
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    )
GROUP BY Logistic_service;
```

### 3-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 10/15 æ‡‰è©²å£“çš„ä»£æ”¶è«‹æ¬¾(10/6-10/12) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-15'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
WHERE oa.CheckoutDate >= '2025-10-06 00:00:00'
    AND oa.CheckoutDate < '2025-10-13 00:00:00'
    AND (
        oa.Logistic_service IN ('01','03','05','10','23')
        OR
        (oa.Logistic_service IN ('02','04','22','24') AND oa.advance_Granted = '1')
    )
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 4:è£œå£“ 10/1 çš„ä»£æ”¶è«‹æ¬¾æ—¥(21 - 7-11å†·å‡C2C)

### 4-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 21 è£œå£“ 10/1 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 9/22-9/28) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-09-22 00:00:00'
        AND datadatetime < '2025-09-29 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );
```

### 4-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 21 è£œå£“ 10/1 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 9/22-9/28) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-01'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-09-22 00:00:00'
        AND datadatetime < '2025-09-29 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 5:è£œå£“ 10/8 çš„ä»£æ”¶è«‹æ¬¾æ—¥(21 - 7-11å†·å‡C2C)

### 5-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 21 è£œå£“ 10/8 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 9/29-10/5) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-09-29 00:00:00'
        AND datadatetime < '2025-10-06 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );
```

### 5-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 21 è£œå£“ 10/8 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 9/29-10/5) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-08'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-09-29 00:00:00'
        AND datadatetime < '2025-10-06 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 6:è£œå£“ 10/15 çš„ä»£æ”¶è«‹æ¬¾æ—¥(21 - 7-11å†·å‡C2C)

### 6-1. å…ˆæŸ¥è©¢ç¢ºèªç­†æ•¸

```sql
-- ========================================
-- SELECT - 21 è£œå£“ 10/15 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 10/6-10/12) - æŽ’é™¤é€€è²¨
-- ========================================
SELECT
    COUNT(*) as TotalRows
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-10-06 00:00:00'
        AND datadatetime < '2025-10-13 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );
```

### 6-2. ç¢ºèªç„¡èª¤å¾ŒåŸ·è¡Œæ›´æ–°

```sql
-- ========================================
-- UPDATE - 21 è£œå£“ 10/15 çš„ä»£æ”¶è«‹æ¬¾(ç‰©æµæ­·ç¨‹æ™‚é–“åœ¨ 10/6-10/12) - æŽ’é™¤é€€è²¨
-- ========================================
UPDATE oa
SET CheckoutdaisouDate = '2025-10-15'
FROM Order_Accounting oa
INNER JOIN Order_Info oi
    ON oa.LogisticNumber = oi.LogisticNumber
    AND oa.sno = oi.sno
INNER JOIN Branch_Member bm
    ON oa.user_account = bm.user_account
    AND oa.sonid = bm.sonid
INNER JOIN (
    SELECT DISTINCT
        CAST(LogisticNumber AS VARCHAR) AS LogisticNumber,
        CAST(paymentno AS VARCHAR) AS paymentno
    FROM LogisticProcessHistory
    WHERE datadatetime >= '2025-10-06 00:00:00'
        AND datadatetime < '2025-10-13 00:00:00'
        AND respcode = '8000'
        AND FileTitle = 'NPPS'
        AND LogisticServiceID = '21'
) lph
    ON oa.LogisticNumber = lph.LogisticNumber
    AND oa.paymentno = lph.paymentno
WHERE oa.Logistic_service = '21'
    AND oa.DeliverMode = '01'
    AND oa.Checkoutable = '1'
    AND oi.ReconciliationResult = 'Y'
    AND oa.CheckoutDate IS NULL
    AND oa.CheckoutdaisouDate IS NULL
    AND oa.GrantdaisouDate IS NULL
    -- â˜…â˜…â˜… æŽ’é™¤é€€è²¨/ç•°å¸¸è¨‚å–® â˜…â˜…â˜…
    AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
    AND bm.user_account NOT IN (
        SELECT user_account
        FROM Additional_SetUP
        WHERE stop_grant = '1'
    );

-- æŸ¥çœ‹æ›´æ–°ç­†æ•¸
SELECT @@ROWCOUNT as UpdatedRows;
```

---

## æ­¥é©Ÿ 7:é©—è­‰æ›´æ–°çµæžœ

```sql
-- ========================================
-- é©—è­‰ - æŸ¥çœ‹æ›´æ–°çµæžœ(åˆ†ç‰©æµé¡žåž‹å’Œæ—¥æœŸ)
-- ========================================
SELECT
    CheckoutdaisouDate,
    Logistic_service,
    CASE
        WHEN Logistic_service IN ('01','03','05','10','23') THEN 'C2Cäº¤è²¨ä¾¿'
        WHEN Logistic_service = '21' THEN 'C2Cå†·å‡(21)'
        WHEN Logistic_service IN ('02','04','22','24') THEN 'å¤§å®—å¿«æ’¥'
        ELSE 'å…¶ä»–'
    END AS ServiceType,
    advance_Granted,
    COUNT(*) as OrderCount,
    SUM(TotalAmount) as TotalAmount
FROM Order_Accounting
WHERE CheckoutdaisouDate IN ('2025-10-01', '2025-10-08', '2025-10-15')
    AND (
        Logistic_service IN ('01','03','05','10','21','23')
        OR
        (Logistic_service IN ('02','04','22','24') AND advance_Granted = '1')
    )
GROUP BY CheckoutdaisouDate, Logistic_service, advance_Granted
ORDER BY CheckoutdaisouDate, Logistic_service;
```

---

## âš ï¸ é‡è¦æé†’

### èˆ‡åŽŸç‰ˆçš„å·®ç•°

**åŽŸç‰ˆ** (è£œå£“ä»£æ”¶è«‹æ¬¾æ—¥_å®Œæ•´æ­¥é©Ÿ.md):
- âŒ æ²’æœ‰æª¢æŸ¥ `Detail_Status_Description`
- âŒ æœƒå£“åˆ°é€€è²¨ã€å–æ¶ˆã€é€¾æœŸç­‰ç•°å¸¸è¨‚å–®

**ä¿®æ­£ç‰ˆ** (æœ¬æ–‡ä»¶):
- âœ… åŠ å…¥ `AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')`
- âœ… åªå£“æ­£å¸¸å–ä»¶çš„è¨‚å–®
- âœ… é¿å…èª¤æ’¥ä»£æ”¶æ¬¾çµ¦ç•°å¸¸è¨‚å–®

### é©ç”¨æ™‚æ©Ÿ

- âœ… **æœªä¾†æ‰€æœ‰çš„è£œå£“ä½œæ¥­éƒ½æ‡‰ä½¿ç”¨æ­¤ç‰ˆæœ¬**
- âœ… å¯æ•´åˆåˆ° `WeeklySettlement` è‡ªå‹•æŽ’ç¨‹ä¸­
- âœ… æ‰‹å‹•è£œå£“æ™‚å‹™å¿…ä½¿ç”¨æ­¤ç‰ˆæœ¬

### å¾ŒçºŒå»ºè­°

å»ºè­°å°‡æ­¤é‚è¼¯æ•´åˆåˆ°ç³»çµ±æŽ’ç¨‹ä¸­,ä¿®æ”¹ `WeeklySettlement` çš„ SQL:
```sql
-- åœ¨å£“ CheckoutdaisouDate æ™‚åŠ å…¥
AND oi.Detail_Status_Description IN ('è²·å®¶å·²å–ä»¶', 'æ¶ˆè²»è€…æˆåŠŸå–ä»¶')
```
